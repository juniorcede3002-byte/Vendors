<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vendor | Premium Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #2563eb;
    --dark: #0f172a;
    --light: #f8fafc;
    --accent: #3b82f6;
    --success: #22c55e;
    --danger: #ef4444;
    --warning: #f59e0b;
    --radius: 12px;
    --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
}

body { 
    font-family: 'Inter', sans-serif; 
    background: #f1f5f9; 
    color: #1e293b;
    margin: 0; 
    padding: 0; 
    line-height: 1.5;
}

/* Header Estilizado */
header { 
    background: var(--dark); 
    color: #fff; 
    padding: 1rem 2rem; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    position: fixed; 
    top: 0; 
    width: 100%; 
    z-index: 100; 
    box-sizing: border-box;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}

header button { 
    background: rgba(255,255,255,0.1); 
    color: #fff; 
    border: 1px solid rgba(255,255,255,0.2); 
    padding: 8px 16px; 
    border-radius: 8px; 
    cursor: pointer; 
    font-weight: 500;
    transition: all 0.3s;
    margin-left: 5px;
}

header button:hover {
    background: #fff;
    color: var(--dark);
}

/* Contenedor Principal */
.container { 
    max-width: 1100px; 
    margin: auto; 
    padding: 100px 20px 40px; 
    display: none; 
}

/* Tabs Estilo Moderno */
.tabs { 
    display: flex; 
    gap: 10px; 
    margin-bottom: 25px; 
    background: #e2e8f0;
    padding: 5px;
    border-radius: 14px;
}

.tabs button { 
    flex: 1; 
    padding: 12px; 
    cursor: pointer; 
    border: none; 
    border-radius: 10px; 
    background: transparent; 
    font-weight: 600;
    color: #64748b;
    transition: all 0.3s; 
}

.tabs button.active { 
    background: #fff; 
    color: var(--primary); 
    box-shadow: var(--shadow);
}

/* Tarjetas de Contenido */
.tab-content { 
    display: none; 
    background: #fff; 
    padding: 30px; 
    border-radius: var(--radius); 
    box-shadow: var(--shadow); 
}

.tab-content.active { display: block; animation: fadeIn 0.4s ease; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Inputs y Botones */
input, textarea, select { 
    width: 100%; 
    padding: 12px; 
    margin-top: 8px; 
    margin-bottom: 15px;
    border-radius: 8px; 
    border: 1px solid #cbd5e1; 
    box-sizing: border-box;
    font-size: 0.95rem;
}

input:focus { outline: 2px solid var(--accent); border-color: transparent; }

button { 
    background: var(--primary); 
    color: #fff; 
    border: none; 
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer; 
    font-weight: 600;
    transition: filter 0.2s, transform 0.1s; 
}

button:active { transform: scale(0.98); }

/* Grid de Productos */
#productsList {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.product { 
    border: 1px solid #e2e8f0; 
    padding: 0; 
    border-radius: var(--radius); 
    background: #fff; 
    overflow: hidden;
    transition: transform 0.3s;
    display: flex;
    flex-direction: column;
}

.product:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }

.product-info { padding: 15px; flex-grow: 1; }

.product img { width: 100%; height: 200px; object-fit: cover; }

.product strong { font-size: 1.2rem; display: block; margin-bottom: 5px; }

.price-tag { color: var(--primary); font-size: 1.3rem; font-weight: 700; margin: 10px 0; }

.actions { display: flex; flex-direction: column; gap: 8px; padding: 15px; background: #f8fafc; border-top: 1px solid #eee; }

/* √ìrdenes y Status */
.order { 
    border-left: 5px solid var(--primary); 
    padding: 20px; 
    margin-top: 15px; 
    border-radius: 8px; 
    background: #fff; 
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.status-pendiente { color: var(--warning); background: #fef3c7; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; }
.status-entregado { color: var(--success); background: #dcfce7; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; }
.status-cancelada { color: var(--danger); background: #fee2e2; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; }

/* Modales */
.modal { 
    display: none; 
    position: fixed; 
    top: 0; left: 0; width: 100%; height: 100%; 
    background: rgba(15, 23, 42, 0.8); 
    backdrop-filter: blur(4px);
    justify-content: center; align-items: center; z-index: 1000;
}

.modal-content { 
    background: #fff; 
    padding: 30px; 
    border-radius: 16px; 
    max-width: 450px; 
    width: 90%; 
    position: relative; 
    box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
}

.modal-content button.close { 
    position: absolute; top: 15px; right: 15px; 
    background: #f1f5f9; color: #64748b; 
    border-radius: 50%; width: 35px; height: 35px; padding: 0;
}

/* Filtros */
.filters { display: flex; gap: 10px; margin-bottom: 20px; }
</style>
</head>
<body>

<header>
  <div style="font-weight: 800; font-size: 1.4rem; letter-spacing: -1px;">
    <i class="fa fa-bolt" style="color: var(--accent);"></i> VENDOR
  </div>
  <div id="authButtons">
    <button onclick="showLoginForm()"><i class="fa fa-sign-in-alt"></i> Entrar</button>
    <button onclick="showRegisterForm()">Crear Cuenta</button>
    <button onclick="loginWithGoogle()" style="background: #db4437; border:none;"><i class="fab fa-google"></i></button>
  </div>
  <div id="userInfo" style="display:none;">
    <span id="userEmail" style="margin-right: 15px; font-size: 0.9rem; opacity: 0.8;"></span>
    <button onclick="openConfig()"><i class="fa fa-cog"></i></button>
    <button onclick="logout()"><i class="fa fa-sign-out-alt"></i></button>
  </div>
</header>

<div class="container" id="dashboard">
  <div class="tabs">
    <button class="tab-btn active" data-tab="productsTab"><i class="fa fa-th-large"></i> Productos</button>
    <button class="tab-btn" data-tab="cartTab"><i class="fa fa-shopping-cart"></i> Carrito</button>
    <button class="tab-btn" data-tab="ordersTab"><i class="fa fa-box"></i> Mis Compras</button>
    <button class="tab-btn" data-tab="adminTab" id="adminTabBtn"><i class="fa fa-lock"></i> Panel Admin</button>
  </div>

  <div id="productsTab" class="tab-content active">
    <div class="filters">
        <input id="search" placeholder="üîç Buscar productos..." oninput="filterProducts()">
        <input id="maxPrice" type="number" placeholder="üí∞ Precio m√°x." oninput="filterProducts()" style="width: 200px;">
    </div>
    <div id="productsList"></div>
  </div>

  <div id="cartTab" class="tab-content">
    <h2 style="margin-top:0"><i class="fa fa-shopping-cart text-primary"></i> Tu Carrito</h2>
    <div id="cartList" style="margin-bottom: 20px;"><i>Tu carrito est√° vac√≠o</i></div>
    <div style="display:flex; gap:10px;">
        <button onclick="purchaseCart()" style="flex:2">Finalizar Compra</button>
        <button onclick="emptyCart()" style="flex:1; background:#94a3b8;">Vaciar</button>
    </div>
  </div>

  <div id="ordersTab" class="tab-content">
    <h2 style="margin-top:0">Historial de Compras</h2>
    <div id="purchaseHistory"></div>
  </div>

  <div id="adminTab" class="tab-content">
    <div id="adminPanel">
      <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 1px dashed #cbd5e1;">
          <h3 style="margin-top:0">A√±adir Nuevo Producto</h3>
          <input id="name" placeholder="Nombre del producto">
          <textarea id="description" placeholder="Descripci√≥n detallada"></textarea>
          <input id="price" type="number" placeholder="Precio ($)">
          <label style="font-size: 0.8rem; color: #64748b;">Imagen o Video del producto:</label>
          <input id="media" type="file" accept="image/*,video/*">
          <button onclick="uploadProduct()" style="width:100%; margin-top:10px;">Publicar Producto</button>
      </div>

      <h3>Gesti√≥n de Pedidos</h3>
      <div id="ordersList"></div>
    </div>
  </div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <button class="close" onclick="closeModal()">&times;</button>
    <div id="modalBody"></div>
  </div>
</div>

<script>
// --- TU L√ìGICA DE FIREBASE SE MANTIENE EXACTAMENTE IGUAL ---
firebase.initializeApp({
  apiKey: "AIzaSyBXYrQwpfcuAili1HvrmDGEWKjj_2j_lzY",
  authDomain: "proyectovendor.firebaseapp.com",
  projectId: "proyectovendor"
});
const db = firebase.firestore();
const auth = firebase.auth();
const provider = new firebase.auth.GoogleAuthProvider();

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let role = "usuario";

const modal = document.getElementById("modal");
const modalBody = document.getElementById("modalBody");
function openModal(content){ modal.style.display="flex"; modalBody.innerHTML=content; }
function closeModal(){ modal.style.display="none"; }
function showModalMessage(msg){ openModal(`<div style="text-align:center; padding:20px;"><i class="fa fa-check-circle" style="font-size:3rem; color:var(--success)"></i><p style="font-size:1.2rem; margin-top:15px;">${msg}</p></div>`); setTimeout(closeModal,1500); }

auth.onAuthStateChanged(user => {
    if(user){
        initUser(user);
    } else {
        document.getElementById("authButtons").style.display = "inline-block";
        document.getElementById("userInfo").style.display = "none";
        document.getElementById("dashboard").style.display = "none";
    }
});

function showLoginForm(){
  openModal(`<h3>¬°Bienvenido de nuevo!</h3>
  <input id="loginEmail" placeholder="Email">
  <input id="loginPass" placeholder="Contrase√±a" type="password">
  <button onclick="login()" style="width:100%">Entrar al Sistema</button>
  <p style="text-align:center; font-size:0.8rem; margin: 15px 0;">O tambi√©n puedes</p>
  <button onclick="loginWithGoogle()" style="width:100%; background:#db4437"><i class="fab fa-google"></i> Continuar con Google</button>
  <button onclick="showResetPass()" style="background:none; color:var(--primary); width:100%; margin-top:10px;">Olvid√© mi contrase√±a</button>`);
}

function showRegisterForm(){
  openModal(`<h3>Crear Cuenta Nueva</h3>
  <input id="regEmail" placeholder="Email">
  <input id="regPass" placeholder="Contrase√±a" type="password">
  <button onclick="register()" style="width:100%">Registrarse Ahora</button>
  <button onclick="loginWithGoogle()" style="width:100%; background:#db4437; margin-top:10px;"><i class="fab fa-google"></i> Registrarse con Google</button>`);
}

function showResetPass(){
  const email = prompt("Ingrese su correo para recuperar contrase√±a:");
  if(email) auth.sendPasswordResetEmail(email).then(()=>alert("Correo enviado")).catch(e=>alert(e.message));
}

function login(){
  const email=document.getElementById("loginEmail").value;
  const pass=document.getElementById("loginPass").value;
  auth.signInWithEmailAndPassword(email,pass).then(u=>{ closeModal(); initUser(u.user); }).catch(e=>alert(e.message));
}

function register(){
  const email=document.getElementById("regEmail").value;
  const pass=document.getElementById("regPass").value;
  auth.createUserWithEmailAndPassword(email,pass).then(u=>{ closeModal(); initUser(u.user); }).catch(e=>alert(e.message));
}

function loginWithGoogle(){
  auth.signInWithPopup(provider).then(result => { closeModal(); initUser(result.user); }).catch(e=>alert(e.message));
}

function logout(){ auth.signOut().then(()=>location.reload()); }

async function initUser(user){
  document.getElementById("authButtons").style.display="none";
  document.getElementById("userInfo").style.display="inline-block";
  document.getElementById("userEmail").innerText=user.email;

  const docRef = db.collection("users").doc(user.uid);
  const docSnap = await docRef.get();
  if(!docSnap.exists){
    await docRef.set({pais:'',residencia:'',name:user.displayName||'',email:user.email});
  }

  role = (user.email==="admin@vendors.com") ? "admin" : "usuario";
  document.getElementById("dashboard").style.display="block";
  toggleAdmin();
  setUpTabs();
  loadProducts();
  loadOrders();
  loadUserOrders();
  renderCart();
}

async function openConfig(){
  const user = auth.currentUser;
  const docSnap = await db.collection("users").doc(user.uid).get();
  const data = docSnap.data();
  openModal(`<h3>Configuraci√≥n de Perfil</h3>
    <label>Nombre Completo</label><input id="configName" value="${data.name||''}">
    <label>Email</label><input id="configEmail" value="${data.email||''}">
    <label>Pa√≠s</label><input id="configCountry" value="${data.pais||''}">
    <label>Ciudad/Residencia</label><input id="configResidence" value="${data.residencia||''}">
    <label>Cambiar Contrase√±a</label><input id="configPass" type="password" placeholder="Dejar vac√≠o para no cambiar">
    <button onclick="updateConfig()" style="width:100%">Actualizar Datos</button>`);
}

async function updateConfig(){
  const user = auth.currentUser;
  const name=document.getElementById("configName").value;
  const email=document.getElementById("configEmail").value;
  const pais=document.getElementById("configCountry").value;
  const residencia=document.getElementById("configResidence").value;
  const pass=document.getElementById("configPass").value;

  await db.collection("users").doc(user.uid).update({name,email,pais,residencia});
  if(name) user.updateProfile({displayName:name});
  if(email) user.updateEmail(email).catch(e=>alert(e.message));
  if(pass) user.updatePassword(pass).catch(e=>alert(e.message));
  showModalMessage("Configuraci√≥n actualizada");
  closeModal();
}

function setUpTabs(){
  document.querySelectorAll(".tab-btn").forEach(btn=>{
    btn.onclick = () => {
      document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      document.querySelectorAll(".tab-content").forEach(tab=>tab.classList.remove("active"));
      document.getElementById(btn.dataset.tab).classList.add("active");
    };
  });
}

function toggleAdmin(){ 
  const adminTab = document.querySelector("[data-tab='adminTab']");
  if(role==="admin"){ 
    document.getElementById("adminPanel").style.display="block"; 
    adminTab.style.display="inline-block"; 
  }
  else { 
    document.getElementById("adminPanel").style.display="none"; 
    adminTab.style.display="none"; 
  }
}

async function loadProducts(){
  const productsList = document.getElementById("productsList");
  productsList.innerHTML = "Cargando cat√°logo...";
  db.collection("products").onSnapshot(snapshot=>{
    let html="";
    snapshot.forEach(doc=>{
      const p = doc.data();
      html+=`
      <div class="product">
        ${p.media ? `<img src="${p.media}">` : `<div style="height:200px; background:#f1f5f9; display:flex; align-items:center; justify-content:center;"><i class="fa fa-image fa-3x" style="color:#cbd5e1"></i></div>` }
        <div class="product-info">
            <strong>${p.name}</strong>
            <p style="color:#64748b; font-size:0.9rem; margin:5px 0;">${p.description}</p>
            <div class="price-tag">$${p.price}</div>
        </div>
        <div class="actions">
          <button onclick="addToCart('${doc.id}','${p.name}',${p.price},'${p.media||''}')"><i class="fa fa-cart-plus"></i> A√±adir al carrito</button>
          ${role==='admin'?`
          <div style="display:flex; gap:5px;">
            <button onclick="editProductForm('${doc.id}')" style="background:#64748b; flex:1"><i class="fa fa-edit"></i></button>
            <button onclick="deleteProduct('${doc.id}')" style="background:var(--danger); flex:1"><i class="fa fa-trash"></i></button>
          </div>`:''}
        </div>
      </div>`;
    });
    productsList.innerHTML = html || "<i>No hay productos disponibles por el momento.</i>";
  });
}

function filterProducts(){
  const search = document.getElementById("search").value.toLowerCase();
  const maxPrice = parseFloat(document.getElementById("maxPrice").value) || Infinity;
  const products = document.querySelectorAll("#productsList .product");
  products.forEach(p=>{
    const name = p.querySelector("strong").innerText.toLowerCase();
    const priceStr = p.querySelector(".price-tag").innerText.replace('$','');
    const price = parseFloat(priceStr);
    if(name.includes(search) && price <= maxPrice) p.style.display="flex"; else p.style.display="none";
  });
}

function addToCart(id,name,price,media){
  cart.push({id,name,price,media});
  localStorage.setItem("cart",JSON.stringify(cart));
  renderCart();
  showModalMessage("¬°A√±adido al carrito!");
}

function renderCart(){
  const list = document.getElementById("cartList");
  if(cart.length===0){ list.innerHTML="<div style='text-align:center; padding:40px; color:#94a3b8'><i class='fa fa-shopping-basket fa-3x'></i><p>El carrito est√° vac√≠o</p></div>"; return; }
  let html = '<table style="width:100%; border-collapse:collapse;">';
  cart.forEach((p,i)=>{
      html += `<tr style="border-bottom:1px solid #eee;">
        <td style="padding:10px 0;"><b>${p.name}</b><br><small>$${p.price}</small></td>
        <td style="text-align:right"><button onclick="removeFromCart(${i})" style="background:none; color:var(--danger); padding:5px;"><i class="fa fa-times"></i></button></td>
      </tr>`;
  });
  const total = cart.reduce((s,p)=>s+p.price,0);
  html += `</table><div style="text-align:right; margin-top:15px; font-size:1.2rem;">Total: <b>$${total}</b></div>`;
  list.innerHTML = html;
}

function removeFromCart(index){
  cart.splice(index,1);
  localStorage.setItem("cart",JSON.stringify(cart));
  renderCart();
}

function emptyCart(){
  if(confirm("¬øVaciar todo el carrito?")) { cart=[]; localStorage.setItem("cart",JSON.stringify(cart)); renderCart(); }
}

async function purchaseCart(){
  if(cart.length===0) return showModalMessage("Carrito vac√≠o");
  const user = auth.currentUser;
  const buyerName = prompt("Nombre completo del receptor:");
  const phone = prompt("Tel√©fono de contacto:");
  const address = prompt("Direcci√≥n de entrega:");
  if(!buyerName||!phone||!address) return alert("Completa todos los datos para el env√≠o");
  const order = {user:user.uid, userEmail:user.email, buyerName, phone, address, products:cart, status:"pendiente", createdAt:new Date()};
  await db.collection("orders").add(order);
  showModalMessage("¬°Pedido realizado con √©xito!");
  cart=[]; localStorage.setItem("cart",JSON.stringify(cart)); renderCart();
}

function loadUserOrders(){
  const history = document.getElementById("purchaseHistory");
  auth.onAuthStateChanged(user=>{
    if(!user) return;
    db.collection("orders").where("user","==",user.uid)
      .onSnapshot(snapshot=>{
        let html="";
        snapshot.forEach(doc=>{
          const o = doc.data();
          const total = o.products.reduce((sum,p)=>sum+p.price,0);
          html+=`
          <div class="order">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <strong>Pedido #${doc.id.substring(0,8)}</strong>
                <span class="status-${o.status.replace(/\s/g,'-')}">${o.status.toUpperCase()}</span>
            </div>
            <div style="margin-top:10px;">
                <button onclick="toggleDetails('${doc.id}')" style="background:#f1f5f9; color:#475569; font-size:0.8rem;">Ver Detalles</button>
            </div>
            <div id="details-${doc.id}" style="display:none; padding:15px; background:#f8fafc; border-radius:8px; margin-top:10px; font-size:0.9rem;">
                <p><b>Direcci√≥n:</b> ${o.address}</p>
                <p><b>Productos:</b></p>
                <ul style="padding-left:20px;">${o.products.map(p=>`<li>${p.name} ($${p.price})</li>`).join('')}</ul>
                <hr style="border:0; border-top:1px solid #e2e8f0;">
                <p style="font-size:1.1rem"><b>Total: $${total}</b></p>
            </div>
          </div>`;
        });
        history.innerHTML = html || "<i>No has realizado compras todav√≠a.</i>";
      });
  });
}

function toggleDetails(id){
  const el = document.getElementById(`details-${id}`);
  if(el) el.style.display = el.style.display==="none"?"block":"none";
}

function loadOrders(){
  if(role!=="admin") return;
  const ordersList = document.getElementById("ordersList");
  db.collection("orders").onSnapshot(snapshot=>{
    let html="";
    snapshot.forEach(doc=>{
      const o = doc.data();
      const total = o.products.reduce((sum,p)=>sum+p.price,0);
      html+=`
      <div class="order" style="border-left-color: var(--dark)">
        <strong>Orden de: ${o.buyerName}</strong> <br>
        <small>${o.userEmail}</small>
        <div style="margin:10px 0;">Status actual: <span class="status-${o.status.replace(/\s/g,'-')}">${o.status}</span></div>
        <button onclick="toggleAdminDetails('${doc.id}')" style="background:#f1f5f9; color:#475569;">Gestionar</button>
        <div id="adminDetails-${doc.id}" style="display:none; padding:15px; background:#f8fafc; border-radius:8px; margin-top:10px;">
          <ul style="list-style:none; padding:0; font-size:0.9rem;">
            <li><b>Tel√©fono:</b> ${o.phone}</li>
            <li><b>Direcci√≥n:</b> ${o.address}</li>
            <li><b>Total:</b> $${total}</li>
          </ul>
          <div style="margin-top:10px;">
            <label>Cambiar Estado:</label>
            <select id="status-${doc.id}">
                <option ${o.status==='pendiente'?'selected':''}>pendiente</option>
                <option ${o.status==='revision de pago'?'selected':''}>revision de pago</option>
                <option ${o.status==='pago verificado'?'selected':''}>pago verificado</option>
                <option ${o.status==='en camino'?'selected':''}>en camino</option>
                <option ${o.status==='entregado'?'selected':''}>entregado</option>
                <option ${o.status==='cancelada'?'selected':''}>cancelada</option>
            </select>
            <button onclick="updateOrderStatus('${doc.id}')" style="width:100%; background:var(--dark)">Actualizar Pedido</button>
          </div>
        </div>
      </div>`;
    });
    ordersList.innerHTML = html || "<i>No hay √≥rdenes pendientes.</i>";
  });
}

function toggleAdminDetails(id){
  const el = document.getElementById(`adminDetails-${id}`);
  if(el) el.style.display = el.style.display==="none"?"block":"none";
}

function updateOrderStatus(id){
  const status = document.getElementById(`status-${id}`).value;
  db.collection("orders").doc(id).update({status});
  showModalMessage("Estado actualizado");
}

function uploadProduct(){
  const name=document.getElementById("name").value;
  const description=document.getElementById("description").value;
  const price=parseFloat(document.getElementById("price").value);
  const mediaFile=document.getElementById("media").files[0];
  if(!name || !description || !price) return alert("Completa todos los campos");

  if(mediaFile){
    const reader = new FileReader();
    reader.onload = async function(e){
      const mediaURL = e.target.result;
      await db.collection("products").add({name,description,price,media:mediaURL});
      showModalMessage("¬°Producto publicado!");
      document.getElementById("name").value="";
      document.getElementById("description").value="";
      document.getElementById("price").value="";
      document.getElementById("media").value="";
    }
    reader.readAsDataURL(mediaFile);
  } else {
    db.collection("products").add({name,description,price}).then(()=>showModalMessage("¬°Producto publicado!"));
  }
}

function editProductForm(id){
  db.collection("products").doc(id).get().then(doc=>{
    const p = doc.data();
    openModal(`<h3>Editar Producto</h3>
      <input id="editName" value="${p.name}">
      <textarea id="editDescription">${p.description}</textarea>
      <input id="editPrice" type="number" value="${p.price}">
      <button onclick="updateProduct('${id}')" style="width:100%">Guardar Cambios</button>`);
  });
}

function updateProduct(id){
  const name=document.getElementById("editName").value;
  const description=document.getElementById("editDescription").value;
  const price=parseFloat(document.getElementById("editPrice").value);
  db.collection("products").doc(id).update({name,description,price}).then(()=>{
    showModalMessage("Actualizado correctamente");
    closeModal();
  });
}

function deleteProduct(id){
  if(confirm("¬øEst√°s seguro de eliminar este producto?")) db.collection("products").doc(id).delete().then(()=>showModalMessage("Eliminado"));
}
</script>

</body>
</html>
