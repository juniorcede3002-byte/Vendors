<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Vendors Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial; background:#f4f6f8; margin:0 }
header { background:#111; color:white; padding:15px }
section { padding:20px }
.card { background:white; padding:15px; margin-bottom:15px; border-radius:8px }
button { padding:10px; cursor:pointer }
.admin { border-left:5px solid red }
.user { border-left:5px solid green }
</style>
</head>

<body>

<header>
  <h2>Vendors</h2>
  <button onclick="loginGoogle()">Iniciar sesiÃ³n con Google</button>
  <button onclick="logout()">Salir</button>
</header>

<section id="app"></section>

<script>
// ðŸ”¥ Firebase config
firebase.initializeApp({
  apiKey: "TU_API_KEY",
  authDomain: "TU_DOMAIN",
  projectId: "TU_PROJECT_ID"
});

const auth = firebase.auth();
const db = firebase.firestore();

// ðŸ” Login Google
function loginGoogle() {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}

function logout() {
  auth.signOut();
}

auth.onAuthStateChanged(async user => {
  if (!user) return;

  const userRef = db.collection("users").doc(user.uid);
  const snap = await userRef.get();

  if (!snap.exists) {
    await userRef.set({
      name: user.displayName,
      email: user.email,
      role: "user"
    });
  }

  loadApp(user.uid);
});

// ðŸ§  Cargar sistema
async function loadApp(uid) {
  const userDoc = await db.collection("users").doc(uid).get();
  const role = userDoc.data().role;

  document.getElementById("app").innerHTML = `
    <h3>Rol: ${role}</h3>

    ${role === "admin" ? `<button onclick="loadOrders(true)">Ver todos los pedidos</button>` : ""}
    <button onclick="loadOrders(false)">Mis pedidos</button>

    <div id="orders"></div>
  `;
}

// ðŸ“¦ Cargar pedidos
function loadOrders(isAdmin) {
  let query = db.collection("orders");

  if (!isAdmin) {
    query = query.where("userId", "==", auth.currentUser.uid);
  }

  query.onSnapshot(snapshot => {
    const cont = document.getElementById("orders");
    cont.innerHTML = "";

    snapshot.forEach(doc => {
      const o = doc.data();
      cont.innerHTML += `
        <div class="card ${isAdmin ? "admin" : "user"}">
          <p><b>Producto:</b> ${o.product}</p>
          <p><b>Precio:</b> $${o.price}</p>
          <p><b>Estado:</b> ${o.status}</p>

          ${!isAdmin ? `
          <form onsubmit="uploadReceipt(event,'${doc.id}')">
            <input type="url" placeholder="URL comprobante" required>
            <button>Adjuntar comprobante</button>
          </form>` : ""}
        </div>
      `;
    });
  });
}

// ðŸ§¾ Subir comprobante
function uploadReceipt(e, orderId) {
  e.preventDefault();
  const url = e.target.querySelector("input").value;

  db.collection("orders").doc(orderId).update({
    receiptUrl: url
  });
}
</script>

</body>
</html>
